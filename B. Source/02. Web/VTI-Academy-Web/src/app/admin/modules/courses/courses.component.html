<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<body>
    <div class="container">
        <div class="table-wrapper">
            <div class="table-title">
                <div class="row">
                    <div class="col-sm-6">
                        <h2><b>Manage Courses</b></h2>
                    </div>
                    <div class="col-sm-6">
                        <a href="#addEmployeeModal" class="btn btn-success" data-toggle="modal"><i class="material-icons">&#xE147;</i> <span>Add New Course</span></a>
                      </div>
                </div>
            </div>
            <table id="tableCourse" class="table table-striped">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Name</th>
                        <th>Image</th>
                        <th>Intro</th>
                        <th>Curriculum</th>
                        <th>Create Date</th>
                        <th>Link</th>
                        <th>SubCourse</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let i of listCourse, let i2 = index">
                        <td>{{(currentPage)*3+(i2+1)}}</td>
                        <td>{{i.name}}</td>
                        <td>
                            <div style="height: 100px; width: 100px; object-fit: cover;">
                            <img src="../../../../assets/img/course_img/{{i.img}}" alt="" class="w-100 h-100" style="object-fit: contain;">
                            </div>
                        </td>
                        <td [innerHTML]="i.intro"></td>
                        <td>{{i.curriculum}}</td>
                        <td>{{i.createDate}}</td>
                        <td><a href="http://localhost:4200/courses/{{i.id}}" target="_blank">Page Link</a></td>
                        <td>
                            <a  href="#showSubCourse" class="edit" data-toggle="modal" (click)="onShowSubCourseClick(i.id)">Show</a>
                        </td>
                        <td>
                            <a  href="#editEmployeeModal" class="edit" data-toggle="modal" (click)="onOpenEditCourse(i)"><i class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>
                            <a class="delete" data-toggle="modal" (click)="deleteCourse(i.id)" ><i style="cursor: pointer" class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i></a>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="clearfix">
                <div class="hint-text">Showing <b>{{getTotalRecordCurrentPage()}}</b> out of <b>{{totalRecord}}</b> entries</div>
                <ul class="pagination">
                    <li class="page-item">
                        <a (click)="getDataFromPreviousPage()" class="page-link">Previous</a>
                    </li>
                    <li *ngFor="let item of getListShowPage()">
                         <button (click)="getDataFromCurrentPage(item)">{{item +1}}</button>
                    </li>
                    <li class="page-item">
                        <a (click)="getDataFromNextPage()" class="page-link">Next</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="showSubCourse" class="modal fade">
        <div class="modal-dialog" id="subcourseTable">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Subcourses</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">                              
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Create Date</th>
                                <th>Content</th>
                                <th>note</th>
                                <th>active</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let i of listSubCourses">
                                <td>{{i.id}}</td>
                                <td>{{i.name}}</td>
                                <td>{{i.createDate}}</td>
                                <td [innerHTML] = "i.content"></td>
                                <td>{{i.note}}</td>
                                <td>{{i.active}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- Edit Modal HTML -->
    <div id="editEmployeeModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form  [formGroup]="editCourseForm" >
                    <div class="modal-header">
                        <h4 class="modal-title">Edit Course</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>ID</label>
                            <input [formControlName]="'id'"  type="number" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label>Name</label>
                            <input [formControlName]="'name'"  type="text" class="form-control" required>
                            <div *ngIf="editCourseForm.get('name')?.errors?.required && editCourseForm.get('name')?.touched"
                                    class="col alert alert-danger" role="alert">
                                    Please enter name of course!
                            </div>
                        </div>
                        <div class="form-group">
                            <label>image</label>
                            <input [formControlName]="'img'"  type="email" class="form-control" readonly>
                            <input type="file" accept="image/*" (change)="onSelectedFileEdit($event)" required>
                        </div>
                        <div class="form-group">
                            <label>curriculum</label>
                            <input [formControlName]="'curriculum'"  type="text" class="form-control" required>
                            <div *ngIf="editCourseForm.get('curriculum')?.errors?.required && editCourseForm.get('curriculum')?.touched"
                                      class="col alert alert-danger" role="alert">
                                      Please enter curriculum of course!
                              </div>
                          </div>
                        <div class="form-group">
                            <label>intro</label>
                            <angular-editor formControlName="intro" [config]="editorConfig" (ngModelChange)="onChange($event)"></angular-editor>
                            <div *ngIf="editCourseForm.get('intro')?.errors?.required && editCourseForm.get('intro')?.touched"
                                    class="col alert alert-danger" role="alert">
                                    Please enter intro of course!
                            </div>
                        </div>
                        <div class="col-md-2">
                                <ol *ngFor="let subcourse of listAllSubCourses; let i=index">
                                        <!-- <input [defaultChecked]="isCheck(subcourse.id)" [formArrayName]="subcourse" type="checkbox" [value]="subcourse.id" (change)="onCheckChange($event)">
                                        {{subcourse.name}} -->
                                        
                                        <li value={{i+1}}>&nbsp;<input type="checkbox" [formArrayName]="'subcourses'" [value]="subcourse.id" (change)="onCheckChangeEdit($event)">
                                        {{subcourse.name}}</li>
                                </ol>
                          </div>
                          
                    </div>
                    <div class="modal-footer">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                        <input type="submit" [disabled]="editCourseForm.invalid" class="btn btn-info" value="Save" (click)="submitEditCourse()">
                    </div>
                </form>
            </div>
        </div>
    </div>




    <!-- Add Modal HTML -->
    <div id="addEmployeeModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <form [formGroup]="addCourseForm" >
                    <div class="modal-header">
                        <h4 class="modal-title">Add Course</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" >&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Name</label>
                            <input [formControlName]="'name'"  type="text" class="form-control" required>
                            <div *ngIf="addCourseForm.get('name')?.errors?.required && addCourseForm.get('name')?.touched"
                                        class="col alert alert-danger" role="alert">
                                        Please enter name of course!
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Image</label>
                            <input [formControlName]="'img'"  type="email" class="form-control" required>
                            <input type="file" accept="image/*" (change)="onSelectedFileAdd($event)" required>
                            <div *ngIf="addCourseForm.get('img')?.errors?.required && addCourseForm.get('img')?.touched"
                                        class="col alert alert-danger" role="alert">
                                        Please enter image of course!
                            </div>
                            <div *ngIf="!file2" class="text-danger">You need a picture</div>
                        </div>
                        <div class="form-group">
                            <label>Intro</label>
                            <angular-editor formControlName="intro" [config]="editorConfig" (ngModelChange)="onChange($event)"></angular-editor>
                            <div *ngIf="addCourseForm.get('intro')?.errors?.required && addCourseForm.get('intro')?.touched"
                                        class="col alert alert-danger" role="alert">
                                        Please enter intro of course!
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Curriculum</label>
                            <input [formControlName]="'curriculum'"  type="text" class="form-control" required>
                            <div *ngIf="addCourseForm.get('curriculum')?.errors?.required && addCourseForm.get('curriculum')?.touched"
                                    class="col alert alert-danger" role="alert">
                                    Please enter curriculum of course!
                            </div>
                        </div>
                        <div *ngFor="let subcourse of listAllSubCourses; let i=index" class="col-md-2">
                            <label>
                              {{i+1}}&nbsp;<input type="checkbox" [value]="subcourse.id" (change)="onCheckChangeAdd($event)">
                              {{subcourse.name}}
                            </label>
                          </div>
                    </div>
                    <div class="modal-footer">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel" >
                        <input type="submit" [disabled]="addCourseForm.invalid || !file2 " (click)="submitAddCourse()" class="btn btn-info" value="Save">
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
